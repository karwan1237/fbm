<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“” Ø®Ø¯Ù…Ø© Ø¨Ø¯Ø§ÙŠØ© Ù†Ø§Ø±ÙŠÙ‡ - F.B.M</title>
<style>
  body {
    margin: 0;
    font-family: 'Tajawal', sans-serif;
    background-color: #fdf7e3;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* ØµÙˆØ±Ø© Ù…Ø¯Ù…Ø¬Ø© Ø¨Ø³ÙŠØ·Ø© (ØªÙ‚Ø¯Ø± Ù„Ø§Ø­Ù‚Ù‹Ø§ ØªØ³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù€ base64 Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù„ÙˆØ¬Ùˆ) */
    background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=") no-repeat center center;
    background-size: cover;
    opacity: 0.18;
    z-index: -1;
  }

  .container {
    text-align: center;
    padding: 16px;
    color: #000;
    font-size: 22px;
    font-weight: bold;
    text-shadow: 0 0 3px rgba(255,255,255,0.9);
  }

  h1 {
    margin-bottom: 12px;
  }

  input {
    padding: 10px;
    margin: 4px;
    font-size: 18px;
    border-radius: 10px;
    border: 1px solid #555;
    width: 42%;
    max-width: 260px;
    font-weight: bold;
  }

  button {
    padding: 10px 14px;
    margin: 4px;
    font-size: 17px;
    border-radius: 10px;
    border: 1px solid #b38b00;
    cursor: pointer;
    background: linear-gradient(135deg, #e0b000, #ffdd33);
    color: #000;
    font-weight: bold;
  }

  .list {
    margin-top: 16px;
    text-align: right;
    background: rgba(255,255,255,0.97);
    border-radius: 10px;
    padding: 10px;
    max-width: 750px;
    margin-right: auto;
    margin-left: auto;
    font-size: 18px;
    font-weight: normal;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
  }

  .contact-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 6px 4px;
    border-bottom: 1px solid rgba(0,0,0,0.08);
    flex-wrap: wrap;
  }

  .contact-main {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
  }

  .contact-text {
    font-weight: 600;
  }

  .status-badge {
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 14px;
    font-weight: bold;
  }

  .status-reached {
    background-color: #c8f7c5;
    border: 1px solid #2ecc71;
    color: #1e824c;
  }

  .status-not {
    background-color: #ffe0e0;
    border: 1px solid #e74c3c;
    color: #c0392b;
  }

  .contact-actions button {
    padding: 5px 8px;
    font-size: 15px;
    margin: 0 2px;
  }

  .filters {
    margin-top: 12px;
  }

  .filters button {
    font-size: 15px;
    padding: 6px 10px;
  }

  .filters button.active {
    border: 2px solid #000;
  }

  .bulk-actions {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 16px;
    align-items: center;
    font-size: 16px;
  }

  .bulk-actions label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }

  .bulk-actions input[type="checkbox"] {
    transform: scale(1.2);
  }

  .stats {
    margin-top: 8px;
    font-size: 17px;
    font-weight: bold;
    text-shadow: 0 0 2px rgba(255,255,255,0.8);
  }

  .footer {
    margin-top: 15px;
    font-size: 16px;
    font-weight: bold;
    color: #222;
    text-shadow: 0 0 3px rgba(255,255,255,1);
  }

  @media (max-width: 600px) {
    .container {
      font-size: 20px;
    }

    input {
      width: 94%;
      max-width: 100%;
      display: block;
      margin-right: auto;
      margin-left: auto;
      font-size: 17px;
    }

    button {
      width: auto;
      font-size: 16px;
    }

    .list {
      font-size: 17px;
      padding: 8px;
    }

    .contact-item {
      flex-direction: column;
      align-items: flex-start;
    }

    .contact-actions {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .bulk-actions {
      flex-direction: column;
      gap: 8px;
    }
  }
</style>
</head>
<body>
<div class="overlay"></div>
<div class="container">
  <h1>ğŸ“” Ø®Ø¯Ù…Ø© Ø¨Ø¯Ø§ÙŠØ© Ù†Ø§Ø±ÙŠÙ‡ - F.B.M</h1>

  <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ">
  <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <button onclick="addContact()">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button onclick="exportCSV()">ğŸ“ ØªØµØ¯ÙŠØ± CSV</button>
  <button onclick="triggerImport()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ TXT/CSV</button>
  <button onclick="resetAllToNotReached()">ğŸ” Ø¬Ø¹Ù„ ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± Ù…ØªØµÙ„</button>

  <input type="file" id="fileInput" accept=".txt,.csv" style="display:none" onchange="importContacts(event)">

  <div class="filters">
    <button id="filter-all" class="active" onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
    <button id="filter-reached" onclick="setFilter('reached')">ØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ âœ…</button>
    <button id="filter-not" onclick="setFilter('not')">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ ğŸš«</button>
  </div>

  <div class="bulk-actions">
    <label>
      <input type="checkbox" id="selectAll" onchange="handleSelectAll(this)">
      ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ (ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
    </label>
    <button onclick="deleteSelected()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>
  </div>

  <div id="stats" class="stats"></div>

  <div class="list" id="contactList"></div>

  <div class="footer">Ù‚Ø§Ù… Ø¨Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¯Ø§Ù†ÙŠØ§Ù„ Ø§Ù„Ù†Ø§ØµØ±ÙŠ</div>
</div>

<script>
// Ø§Ø³ØªØ®Ø¯Ø§Ù… var Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚
var contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
var currentFilter = 'all';

displayContacts();
updateStats();

// Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
['name', 'phone'].forEach(function(id) {
  document.getElementById(id).addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      addContact();
    }
  });
});

function addContact() {
  var nameInput = document.getElementById('name');
  var phoneInput = document.getElementById('phone');
  var name = nameInput.value.trim();
  var phone = phoneInput.value.trim();

  if (!name || !phone) {
    alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
    return;
  }

  var exists = contacts.some(function(c) { return c.phone === phone; });
  if (exists) {
    alert('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©');
    return;
  }

  contacts.push({ name: name, phone: phone, reached: false, selected: false });
  saveAndRefresh();

  nameInput.value = '';
  phoneInput.value = '';
  nameInput.focus();
}

function toggleReached(index, status) {
  contacts[index].reached = status;
  saveAndRefresh(false);
}

function deleteContact(index) {
  if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…ØŸ')) return;
  contacts.splice(index, 1);
  saveAndRefresh();
}

function editContact(index) {
  var newName = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:', contacts[index].name);
  if (newName === null) return;

  var newPhone = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…:', contacts[index].phone);
  if (newPhone === null) return;

  newName = newName.trim();
  newPhone = newPhone.trim();

  if (newName && newPhone) {
    var exists = contacts.some(function(c, i) {
      return c.phone === newPhone && i !== index;
    });
    if (exists) {
      alert('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ø´Ø®Øµ Ø¢Ø®Ø±');
      return;
    }
    contacts[index].name = newName;
    contacts[index].phone = newPhone;
    saveAndRefresh(false);
  }
}

function setFilter(filter) {
  currentFilter = filter;
  document.getElementById('filter-all').classList.remove('active');
  document.getElementById('filter-reached').classList.remove('active');
  document.getElementById('filter-not').classList.remove('active');

  if (filter === 'all') {
    document.getElementById('filter-all').classList.add('active');
  } else if (filter === 'reached') {
    document.getElementById('filter-reached').classList.add('active');
  } else if (filter === 'not') {
    document.getElementById('filter-not').classList.add('active');
  }

  var selectAll = document.getElementById('selectAll');
  if (selectAll) selectAll.checked = false;

  displayContacts();
}

function displayContacts() {
  var list = document.getElementById('contactList');
  list.innerHTML = '';

  contacts.forEach(function(c, i) {
    if (currentFilter === 'reached' && !c.reached) return;
    if (currentFilter === 'not' && c.reached) return;

    var item = document.createElement('div');
    item.className = 'contact-item';

    var main = document.createElement('div');
    main.className = 'contact-main';

    var checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = !!c.selected;
    checkbox.onchange = function(e) {
      toggleSelect(i, e.target.checked);
    };

    var textSpan = document.createElement('span');
    textSpan.className = 'contact-text';
    textSpan.textContent = c.name + ' - ' + c.phone;

    var statusSpan = document.createElement('span');
    statusSpan.className = 'status-badge ' + (c.reached ? 'status-reached' : 'status-not');
    statusSpan.textContent = c.reached ? 'ØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ âœ…' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ ğŸš«';

    main.appendChild(checkbox);
    main.appendChild(textSpan);
    main.appendChild(statusSpan);

    var actions = document.createElement('div');
    actions.className = 'contact-actions';

    var callBtn = document.createElement('button');
    callBtn.textContent = 'ğŸ“';
    callBtn.onclick = function() { window.open('tel:' + c.phone); };

    var editBtn = document.createElement('button');
    editBtn.textContent = 'âœï¸';
    editBtn.onclick = function() { editContact(i); };

    var deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'âŒ';
    deleteBtn.onclick = function() { deleteContact(i); };

    var reachedBtn = document.createElement('button');
    reachedBtn.textContent = 'âœ”ï¸';
    reachedBtn.onclick = function() { toggleReached(i, true); };

    var notReachedBtn = document.createElement('button');
    notReachedBtn.textContent = 'ğŸš«';
    notReachedBtn.onclick = function() { toggleReached(i, false); };

    actions.appendChild(callBtn);
    actions.appendChild(editBtn);
    actions.appendChild(deleteBtn);
    actions.appendChild(reachedBtn);
    actions.appendChild(notReachedBtn);

    item.appendChild(main);
    item.appendChild(actions);
    list.appendChild(item);
  });

  updateStats();
}

function toggleSelect(index, checked) {
  contacts[index].selected = checked;
  localStorage.setItem('contacts', JSON.stringify(contacts));
}

function handleSelectAll(checkbox) {
  var flag = checkbox.checked;
  contacts.forEach(function(c) {
    if (currentFilter === 'reached' && !c.reached) return;
    if (currentFilter === 'not' && c.reached) return;
    c.selected = flag;
  });
  saveAndRefresh(false);
}

function deleteSelected() {
  var selectedCount = contacts.filter(function(c) { return c.selected; }).length;
  if (!selectedCount) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø­Ø°Ù');
    return;
  }

  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (' + selectedCount + ')?')) return;

  contacts = contacts.filter(function(c) { return !c.selected; });
  saveAndRefresh();
  var selectAll = document.getElementById('selectAll');
  if (selectAll) selectAll.checked = false;
}

function updateStats() {
  var statsDiv = document.getElementById('stats');
  var total = contacts.length;
  var reachedCount = contacts.filter(function(c) { return c.reached; }).length;
  var notReachedCount = total - reachedCount;

  statsDiv.textContent =
    'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡: ' + total +
    ' | ØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„: ' + reachedCount +
    ' | Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„: ' + notReachedCount;
}

function saveAndRefresh(resetSelectAll) {
  if (typeof resetSelectAll === 'undefined') resetSelectAll = true;
  localStorage.setItem('contacts', JSON.stringify(contacts));
  displayContacts();
  if (resetSelectAll) {
    var selectAll = document.getElementById('selectAll');
    if (selectAll) selectAll.checked = false;
  }
}

/* ğŸ” Ø¬Ø¹Ù„ ÙƒÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± Ù…ØªØµÙ„ */
function resetAllToNotReached() {
  if (!contacts.length) {
    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.');
    return;
  }

  var confirmReset = confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¬Ø¹Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ø© "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„"ØŸ');
  if (!confirmReset) return;

  contacts.forEach(function(c) {
    c.reached = false;
  });

  currentFilter = 'all';
  document.getElementById('filter-all').classList.add('active');
  document.getElementById('filter-reached').classList.remove('active');
  document.getElementById('filter-not').classList.remove('active');

  saveAndRefresh();
}

/* ØªØµØ¯ÙŠØ± CSV Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Blob */
function exportCSV() {
  var
